import { Renderer } from "./renderer.js";
import { spriteManager } from "./spriteManager.js";
import { coordinate } from "./types.js";

class GameBoard {

	static actualWidth: number;
	static actualHeight: number;
	
	static readonly width = 28;
	static readonly height = 36;

	private renderer: Renderer;

	setRenderer(renderer: Renderer) {
		this.renderer = renderer;
	}

	getEntityPosition(coords: coordinate): coordinate {
		// Get center coordinates
		coords.x += 8;
		coords.y += 8;
		return {
			x: Math.floor((coords.x) / GameBoard.actualWidth * GameBoard.width),
			y: Math.floor((coords.y) / GameBoard.actualHeight * GameBoard.height),
		}
	}

	// 0 is illegal, 1 is legal
	static readonly legalSpaces = [
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,1,0],
		[0,1,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,0,0,1,1,1,1,0, 0,1,1,1,1,0,0,1,1,1,1,1,1,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,1,1,1,1,1, 1,1,1,1,1,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,0,0],
		[1,1,1,1,1,1,1,1,1,1,0,0,0,0, 0,0,0,0,1,1,1,1,1,1,1,1,1,1],
		[0,0,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,1,1,1,1,1, 1,1,1,1,1,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,0,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,1,1,0,0,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,0,0,1,1,1,0],
		[0,0,0,1,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,1,0,0,0],
		[0,0,0,1,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,1,0,0,0],
		[0,1,1,1,1,1,1,0,0,1,1,1,1,0, 0,1,1,1,1,0,0,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0,0,0,0,0,1,0],
		[0,1,0,0,0,0,0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	];

	// 0 is none, 1 is a dot, 2 is an energizer
	static readonly dotSpacesTemplate = [
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],

		[0,1,1,1,1,1,1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,2,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,2,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,1,0],
		[0,1,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,0,0,1,1,1,1,0, 0,1,1,1,1,0,0,1,1,1,1,1,1,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,2,1,1,0,0,1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,0,0,1,1,2,0],
		[0,0,0,1,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,1,0,0,0],
		[0,0,0,1,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,1,0,0,0],
		[0,1,1,1,1,1,1,0,0,1,1,1,1,0, 0,1,1,1,1,0,0,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0,0,0,0,0,1,0],
		[0,1,0,0,0,0,0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	];

	private currentDotSpaces = [
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],

		[0,1,1,1,1,1,1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,2,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,2,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,1,0],
		[0,1,0,0,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,0,0,1,1,1,1,0, 0,1,1,1,1,0,0,1,1,1,1,1,1,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,0,0,0,0,0,1,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,1,0,0,0,0,0,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,1,0,0,0,0,1,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,1,0,0,0,0,1,0],
		[0,2,1,1,0,0,1,1,1,1,1,1,1,0, 0,1,1,1,1,1,1,1,0,0,1,1,2,0],
		[0,0,0,1,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,1,0,0,0],
		[0,0,0,1,0,0,1,0,0,1,0,0,0,0, 0,0,0,0,1,0,0,1,0,0,1,0,0,0],
		[0,1,1,1,1,1,1,0,0,1,1,1,1,0, 0,1,1,1,1,0,0,1,1,1,1,1,1,0],
		[0,1,0,0,0,0,0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0,0,0,0,0,1,0],
		[0,1,0,0,0,0,0,0,0,0,0,0,1,0, 0,1,0,0,0,0,0,0,0,0,0,0,1,0],
		[0,1,1,1,1,1,1,1,1,1,1,1,1,1, 1,1,1,1,1,1,1,1,1,1,1,1,1,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	];

	/**
	 * 0 is nothing
	 * 1 is quad1
	 * 2 is quad2
	 * 3 is quad3
	 * 4 is quad4 
	 * 5 is vertical bar
	 * 6 is horizontal bar
	 */
	static readonly board = [
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[2,6,6,6,6,6,6,6,6,6,6,6,6,3, 2,6,6,6,6,6,6,6,6,6,6,6,6,3],
		[5,0,0,0,0,0,0,0,0,0,0,0,0,5, 5,0,0,0,0,0,0,0,0,0,0,0,0,5],
		[5,0,2,6,6,3,0,2,6,6,6,3,0,5, 5,0,2,6,6,6,3,0,2,6,6,3,0,5],
		[5,0,5,0,0,5,0,5,0,0,0,5,0,5, 5,0,5,0,0,0,5,0,5,0,0,5,0,5],
		[5,0,1,6,6,4,0,1,6,6,6,4,0,1, 4,0,1,6,6,6,4,0,1,6,6,4,0,5],
		[5,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,5],
		[5,0,2,6,6,3,0,2,3,0,2,6,6,6, 6,6,6,3,0,2,3,0,2,6,6,3,0,5],
		[5,0,1,6,6,4,0,5,5,0,1,6,6,3, 2,6,6,4,0,5,5,0,1,6,6,4,0,5],
		[5,0,0,0,0,0,0,5,5,0,0,0,0,5, 5,0,0,0,0,5,5,0,0,0,0,0,0,5],
		[1,6,6,6,6,3,0,5,1,6,6,3,0,5, 5,0,2,6,6,4,5,0,2,6,6,6,6,4],
		[0,0,0,0,0,5,0,5,2,6,6,4,0,1, 4,0,1,6,6,3,5,0,5,0,0,0,0,0],
		[0,0,0,0,0,5,0,5,5,0,0,0,0,0, 0,0,0,0,0,5,5,0,5,0,0,0,0,0],
		[0,0,0,0,0,5,0,5,5,0,2,6,6,0, 0,6,6,3,0,5,5,0,5,0,0,0,0,0],
		[6,6,6,6,6,4,0,1,4,0,5,0,0,0, 0,0,0,5,0,1,4,0,1,6,6,6,6,6],
		[0,0,0,0,0,0,0,0,0,0,5,0,0,0, 0,0,0,5,0,0,0,0,0,0,0,0,0,0],
		[6,6,6,6,6,3,0,2,3,0,5,0,0,0, 0,0,0,5,0,2,3,0,2,6,6,6,6,6],
		[0,0,0,0,0,5,0,5,5,0,1,6,6,6, 6,6,6,4,0,5,5,0,5,0,0,0,0,0],
		[0,0,0,0,0,5,0,5,5,0,0,0,0,0, 0,0,0,0,0,5,5,0,5,0,0,0,0,0],
		[0,0,0,0,0,5,0,5,5,0,2,6,6,6, 6,6,6,3,0,5,5,0,5,0,0,0,0,0],
		[2,6,6,6,6,4,0,1,4,0,1,6,6,3, 2,6,6,4,0,1,4,0,1,6,6,6,6,3],
		[5,0,0,0,0,0,0,0,0,0,0,0,0,5, 5,0,0,0,0,0,0,0,0,0,0,0,0,5],
		[5,0,2,6,6,3,0,2,6,6,6,3,0,5, 5,0,2,6,6,6,3,0,2,6,6,3,0,5],
		[5,0,1,6,3,5,0,1,6,6,6,4,0,1, 4,0,1,6,6,6,4,0,5,2,6,4,0,5],
		[5,0,0,0,5,5,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,5,5,0,0,0,5],
		[1,6,3,0,5,5,0,2,3,0,2,6,6,6, 6,6,6,3,0,2,3,0,5,5,0,2,6,4],
		[2,6,4,0,1,4,0,5,5,0,1,6,6,3, 2,6,6,4,0,5,5,0,1,4,0,1,6,3],
		[5,0,0,0,0,0,0,5,5,0,0,0,0,5, 5,0,0,0,0,5,5,0,0,0,0,0,0,5],
		[5,0,2,6,6,6,6,4,1,6,6,3,0,5, 5,0,2,6,6,4,1,6,6,6,6,3,0,5],
		[5,0,1,6,6,6,6,6,6,6,6,4,0,1, 4,0,1,6,6,6,6,6,6,6,6,4,0,5],
		[5,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,5],
		[1,6,6,6,6,6,6,6,6,6,6,6,6,6, 6,6,6,6,6,6,6,6,6,6,6,6,6,4],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
		[0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0],
	]

	drawMaze(frameNo: number): boolean {
		for (let i = 0; i < GameBoard.height; i++) {
			for (let j = 0; j < GameBoard.width; j++) {
				frameNo -= 1/25;
				if (frameNo <= 0) return;
				switch (GameBoard.board[i][j]) {
					case 1:
						this.renderer.paintBackground({
							placementCoords: {
								x: j * 16,
								y: i * 16
							},
							sheetCoords: spriteManager["quad1Corner"][0]
						});
						break;
					case 2:
						this.renderer.paintBackground({
							placementCoords: {
								x: j * 16,
								y: i * 16
							},
							sheetCoords: spriteManager["quad2Corner"][0]
						});
						break;
					case 3:
						this.renderer.paintBackground({
							placementCoords: {
								x: j * 16,
								y: i * 16
							},
							sheetCoords: spriteManager["quad3Corner"][0]
						});
						break;
					case 4:
						this.renderer.paintBackground({
							placementCoords: {
								x: j * 16,
								y: i * 16
							},
							sheetCoords: spriteManager["quad4Corner"][0]
						});
						break;
					case 5:
						this.renderer.paintBackground({
							placementCoords: {
								x: j * 16,
								y: i * 16
							},
							sheetCoords: spriteManager["verticalBar"][0]
						});
						break;
					case 6:
						this.renderer.paintBackground({
							placementCoords: {
								x: j * 16,
								y: i * 16
							},
							sheetCoords: spriteManager["horizontalBar"][0]
						});
						break;
				}
			};
		}
		if (frameNo >= 0) {
			return true;
		}
		return false;
	}

	drawDots(frameNo: number): boolean {
		// return;
		for (let i = 0; i < GameBoard.height; i++) {
			for (let j = 0; j < GameBoard.width; j++) {
				frameNo -= 1/25;
				if (frameNo <= 1008/25) return
				let num = GameBoard.dotSpacesTemplate[i][j];
				if (num == 1) {
					this.renderer.paintBackground({
						placementCoords: {
							x: j * 16,
							y: i * 16
						},
						sheetCoords: spriteManager["dot"][0]
					});
				} else if (num == 2) {
					this.renderer.paintBackground({
						placementCoords: {
							x: j * 16,
							y: i * 16
						},
						sheetCoords: spriteManager["energizer"][0]
					});
				}
			}
		}
		if (frameNo >= 1008/25) {
			return true;
		}
		return false
	}
}

export { GameBoard }